<style>
@font-face {
	font-family: octicons-link;
	src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
	-ms-text-size-adjust: 100%;
	-webkit-text-size-adjust: 100%;
	line-height: 1.5;
	color: #24292e;
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
	font-size: 16px;
	line-height: 1.5;
	word-wrap: break-word;
}

.markdown-body .pl-c {
	color: #6a737d;
}

.markdown-body .pl-c1,
.markdown-body .pl-s .pl-v {
	color: #005cc5;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
	color: #6f42c1;
}

.markdown-body .pl-smi,
.markdown-body .pl-s .pl-s1 {
	color: #24292e;
}

.markdown-body .pl-ent {
	color: #22863a;
}

.markdown-body .pl-k {
	color: #d73a49;
}

.markdown-body .pl-s,
.markdown-body .pl-pds,
.markdown-body .pl-s .pl-pse .pl-s1,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sre,
.markdown-body .pl-sr .pl-sra {
	color: #032f62;
}

.markdown-body .pl-v,
.markdown-body .pl-smw {
	color: #e36209;
}

.markdown-body .pl-bu {
	color: #b31d28;
}

.markdown-body .pl-ii {
	color: #fafbfc;
	background-color: #b31d28;
}

.markdown-body .pl-c2 {
	color: #fafbfc;
	background-color: #d73a49;
}

.markdown-body .pl-c2::before {
	content: "^M";
}

.markdown-body .pl-sr .pl-cce {
	font-weight: bold;
	color: #22863a;
}

.markdown-body .pl-ml {
	color: #735c0f;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
	font-weight: bold;
	color: #005cc5;
}

.markdown-body .pl-mi {
	font-style: italic;
	color: #24292e;
}

.markdown-body .pl-mb {
	font-weight: bold;
	color: #24292e;
}

.markdown-body .pl-md {
	color: #b31d28;
	background-color: #ffeef0;
}

.markdown-body .pl-mi1 {
	color: #22863a;
	background-color: #f0fff4;
}

.markdown-body .pl-mc {
	color: #e36209;
	background-color: #ffebda;
}

.markdown-body .pl-mi2 {
	color: #f6f8fa;
	background-color: #005cc5;
}

.markdown-body .pl-mdr {
	font-weight: bold;
	color: #6f42c1;
}

.markdown-body .pl-ba {
	color: #586069;
}

.markdown-body .pl-sg {
	color: #959da5;
}

.markdown-body .pl-corl {
	text-decoration: underline;
	color: #032f62;
}

.markdown-body .octicon {
	display: inline-block;
	vertical-align: text-top;
	fill: currentColor;
}

.markdown-body a {
	background-color: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
	outline-width: 0;
}

.markdown-body strong {
	font-weight: inherit;
}

.markdown-body strong {
	font-weight: bolder;
}

.markdown-body h1 {
	font-size: 2em;
	margin: 0.67em 0;
}

.markdown-body img {
	border-style: none;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
	font-family: monospace, monospace;
	font-size: 1em;
}

.markdown-body hr {
	box-sizing: content-box;
	height: 0;
	overflow: visible;
}

.markdown-body input {
	font: inherit;
	margin: 0;
}

.markdown-body input {
	overflow: visible;
}

.markdown-body [type="checkbox"] {
	box-sizing: border-box;
	padding: 0;
}

.markdown-body * {
	box-sizing: border-box;
}

.markdown-body input {
	font-family: inherit;
	font-size: inherit;
	line-height: inherit;
}

.markdown-body a {
	color: #0366d6;
	text-decoration: none;
}

.markdown-body a:hover {
	text-decoration: underline;
}

.markdown-body strong {
	font-weight: 600;
}

.markdown-body hr {
	height: 0;
	margin: 15px 0;
	overflow: hidden;
	background: transparent;
	border: 0;
	border-bottom: 1px solid #dfe2e5;
}

.markdown-body hr::before {
	display: table;
	content: "";
}

.markdown-body hr::after {
	display: table;
	clear: both;
	content: "";
}

.markdown-body table {
	border-spacing: 0;
	border-collapse: collapse;
}

.markdown-body td,
.markdown-body th {
	padding: 0;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
	margin-top: 0;
	margin-bottom: 0;
}

.markdown-body h1 {
	font-size: 32px;
	font-weight: 600;
}

.markdown-body h2 {
	font-size: 24px;
	font-weight: 600;
}

.markdown-body h3 {
	font-size: 20px;
	font-weight: 600;
}

.markdown-body h4 {
	font-size: 16px;
	font-weight: 600;
}

.markdown-body h5 {
	font-size: 14px;
	font-weight: 600;
}

.markdown-body h6 {
	font-size: 12px;
	font-weight: 600;
}

.markdown-body p {
	margin-top: 0;
	margin-bottom: 10px;
}

.markdown-body blockquote {
	margin: 0;
}

.markdown-body ul,
.markdown-body ol {
	padding-left: 0;
	margin-top: 0;
	margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
	x-list-style-type: lower-roman;
	  list-style-type: decimal;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
	list-style-type: lower-alpha;
}

.markdown-body dd {
	margin-left: 0;
}

.markdown-body code {
	font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
	font-size: 12px;
}

.markdown-body pre {
	margin-top: 0;
	margin-bottom: 0;
	font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
	font-size: 12px;
}

.markdown-body .octicon {
	vertical-align: text-bottom;
}

.markdown-body .pl-0 {
	padding-left: 0 !important;
}

.markdown-body .pl-1 {
	padding-left: 4px !important;
}

.markdown-body .pl-2 {
	padding-left: 8px !important;
}

.markdown-body .pl-3 {
	padding-left: 16px !important;
}

.markdown-body .pl-4 {
	padding-left: 24px !important;
}

.markdown-body .pl-5 {
	padding-left: 32px !important;
}

.markdown-body .pl-6 {
	padding-left: 40px !important;
}

.markdown-body::before {
	display: table;
	content: "";
}

.markdown-body::after {
	display: table;
	clear: both;
	content: "";
}

.markdown-body>*:first-child {
	margin-top: 0 !important;
}

.markdown-body>*:last-child {
	margin-bottom: 0 !important;
}

.markdown-body a:not([href]) {
	color: inherit;
	text-decoration: none;
}

.markdown-body .anchor {
	float: left;
	padding-right: 4px;
	margin-left: -20px;
	line-height: 1;
}

.markdown-body .anchor:focus {
	outline: none;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
	margin-top: 0;
	margin-bottom: 16px;
}

.markdown-body hr {
	height: 0.25em;
	padding: 0;
	margin: 24px 0;
	background-color: #e1e4e8;
	border: 0;
}

.markdown-body blockquote {
	padding: 0 1em;
	color: #6a737d;
	border-left: 0.25em solid #dfe2e5;
}

.markdown-body blockquote>:first-child {
	margin-top: 0;
}

.markdown-body blockquote>:last-child {
	margin-bottom: 0;
}

.markdown-body kbd {
	display: inline-block;
	padding: 3px 5px;
	font-size: 11px;
	line-height: 10px;
	color: #444d56;
	vertical-align: middle;
	background-color: #fafbfc;
	border: solid 1px #c6cbd1;
	border-bottom-color: #959da5;
	border-radius: 3px;
	box-shadow: inset 0 -1px 0 #959da5;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
	margin-top: 24px;
	margin-bottom: 16px;
	font-weight: 600;
	line-height: 1.25;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
	color: #1b1f23;
	vertical-align: middle;
	visibility: hidden;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
	text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
	visibility: visible;
}

.markdown-body h1 {
	padding-bottom: 0.3em;
	font-size: 2em;
	border-bottom: 1px solid #eaecef;
}

.markdown-body h2 {
	padding-bottom: 0.3em;
	font-size: 1.5em;
	border-bottom: 1px solid #eaecef;
}

.markdown-body h3 {
	font-size: 1.25em;
}

.markdown-body h4 {
	font-size: 1em;
}

.markdown-body h5 {
	font-size: 0.875em;
}

.markdown-body h6 {
	font-size: 0.85em;
	color: #6a737d;
}

.markdown-body ul,
.markdown-body ol {
	padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
	margin-top: 0;
	margin-bottom: 0;
}

.markdown-body li {
	word-wrap: break-all;
}

.markdown-body li>p {
	margin-top: 16px;
}

.markdown-body li+li {
	margin-top: 0.25em;
}

.markdown-body dl {
	padding: 0;
}

.markdown-body dl dt {
	padding: 0;
	margin-top: 16px;
	font-size: 1em;
	font-style: italic;
	font-weight: 600;
}

.markdown-body dl dd {
	padding: 0 16px;
	margin-bottom: 16px;
}

.markdown-body table {
	display: block;
	width: 100%;
	overflow: auto;
}

.markdown-body table th {
	font-weight: 600;
}

.markdown-body table th,
.markdown-body table td {
	padding: 6px 13px;
	border: 1px solid #dfe2e5;
}

.markdown-body table tr {
	background-color: #fff;
	border-top: 1px solid #c6cbd1;
}

.markdown-body table tr:nth-child(2n) {
	background-color: #f6f8fa;
}

.markdown-body img {
	max-width: 100%;
	box-sizing: content-box;
	background-color: #fff;
}

.markdown-body img[align=right] {
	padding-left: 20px;
}

.markdown-body img[align=left] {
	padding-right: 20px;
}

.markdown-body code {
	padding: 0.2em 0.4em;
	margin: 0;
	font-size: 85%;
	background-color: rgba(27,31,35,0.05);
	border-radius: 3px;
}

.markdown-body pre {
	word-wrap: normal;
}

.markdown-body pre>code {
	padding: 0;
	margin: 0;
	font-size: 100%;
	word-break: normal;
	white-space: pre;
	background: transparent;
	border: 0;
}

.markdown-body .highlight {
	margin-bottom: 16px;
}

.markdown-body .highlight pre {
	margin-bottom: 0;
	word-break: normal;
}

.markdown-body .highlight pre,
.markdown-body pre {
	padding: 16px;
	overflow: auto;
	font-size: 85%;
	line-height: 1.45;
	background-color: #f6f8fa;
	border-radius: 3px;
}

.markdown-body pre code {
	display: inline;
	max-width: auto;
	padding: 0;
	margin: 0;
	overflow: visible;
	line-height: inherit;
	word-wrap: normal;
	background-color: transparent;
	border: 0;
}

.markdown-body .full-commit .btn-outline:not(:disabled):hover {
	color: #005cc5;
	border-color: #005cc5;
}

.markdown-body kbd {
	display: inline-block;
	padding: 3px 5px;
	font: 11px "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
	line-height: 10px;
	color: #444d56;
	vertical-align: middle;
	background-color: #fafbfc;
	border: solid 1px #d1d5da;
	border-bottom-color: #c6cbd1;
	border-radius: 3px;
	box-shadow: inset 0 -1px 0 #c6cbd1;
}

.markdown-body :checked+.radio-label {
	position: relative;
	z-index: 1;
	border-color: #0366d6;
}

.markdown-body .task-list-item {
	list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
	margin-top: 3px;
}

.markdown-body .task-list-item input {
	margin: 0 0.2em 0.25em -1.6em;
	vertical-align: middle;
}

.markdown-body hr {
	border-bottom-color: #eee;
}

</style>
<style>
ol {
    display: block;
    list-style-type: decimal;
}
.pagebreak { page-break-before: always; }
.half { height: 200px; }
</style>

<div class="markdown-body">

<style>
.pagebreak { page-break-before: always; }
.half { height: 200px; }
</style>
<style>
.pagebreak { page-break-before: always; }
.half { height: 200px; }
.markdown-body {
    font-size: 12px;
}
.markdown-body td {
    font-size: 12px;
}
</style>

<h1>Lecture 24 - Zero Knowledge Identification System</h1>

<h2>Reading</h2>

<p>Paper:
<a href="https://arrow.dit.ie/cgi/viewcontent.cgi?article=1031&amp;context=itbj">https://arrow.dit.ie/cgi/viewcontent.cgi?article=1031&amp;context=itbj</a></p>

<p>Look at page 38, section 7.9. to 7.12 on page 43 (this is the page numbers in
the PDF - it is the 28th page OF the PDF).</p>

<p>Walk through of algorithm with the example from the paper.</p>

<p>Also see:
<a href="https://blog.cryptographyengineering.com/2017/01/21/zero-knowledge-proofs-an-illustrated-primer-part-2/">https://blog.cryptographyengineering.com/2017/01/21/zero-knowledge-proofs-an-illustrated-primer-part-2/</a></p>

<p>Also: the reading from last time - has a nice section on this method for
identification of users.</p>

<h2>First a tiny detour - how to authenticate a QR or RFID tag.</h2>

<p>QR codes encode some sort of text. Some RFID tags encode just a number. Others
like NFC encode a chunk of text between 84 and 1084 characters long. Usually
these chunks of text are URLs to some website or set of information. People
would like to use the tags as proof-of-authenticity. The problem is how to get
them to be secure. NFC tags can have computation built int - but it is really a
small amount - the power for the NFC is coming from radio waves being
transmitted from the source. So you take you Android and its tiny transmitter
and send the NFC tag a tiny bit of power - that then looses lots of power
because it has to be picked up by a tiny antenna in the &ldquo;chip&rdquo; and then used to
do a small, small amount of computation and then using that same power send back
an answer. So building any kind of &ldquo;authentication&rdquo; that is meaningful into the
chip is difficult. A QR code is a static image - so it will not do any
computation at all.</p>

<p>So if you can&rsquo;t do the authentication on the chip or device. What about just
adding Two Factor Authentication after the device is scanned. Basically have the
QR or RFID send you to a page where you have to authenticate using a device
(iPhone, Android) and provide proof of your authenticity at that point.</p>

<h2>Zero knowledge proof for use as ID</h2>

<pre><code>  1: package main
  2: 
  3: import (
  4:     &quot;fmt&quot;
  5:     &quot;math/big&quot;
  6:     &quot;math/rand&quot;
  7:     &quot;time&quot;
  8: 
  9:     &quot;github.com/pschlump/MiscLib&quot;
 10: )
 11: 
 12: // From: https://arrow.dit.ie/cgi/viewcontent.cgi?article=1031&amp;context=itbj
 13: // IdProtocalsInCrypto.pdf
 14: 
 15: type DBRecord struct {
 16:     v *big.Int
 17:     e *big.Int
 18:     y *big.Int
 19:     x *big.Int
 20: }
 21: 
 22: var database map[string]*DBRecord
 23: 
 24: func init() {
 25:     database = make(map[string]*DBRecord)
 26: }
 27: 
 28: func main() {
 29: 
 30:     rand.Seed(time.Now().UnixNano())
 31: 
 32:     // ----------------------------------------------------------
 33:     // Registration and Setup
 34:     // ----------------------------------------------------------
 35: 
 36:     // From p40
 37:     p := big.NewInt(88667) // password or hash of password to convert pw to number
 38: 
 39:     q := big.NewInt(1031)      // value 1 = 'q', Pre Chosen : large prime
 40:     alpha := big.NewInt(70322) // value 2 == 'alpha', devisor of (p-1)
 41:     a := big.NewInt(755)       // value 3 == 'a', alpha = (beta**((p-1)/q))mod p
 42:     {
 43: 
 44:         // v = (alpha ^ ( q-a )) % p
 45:         t1 := big.NewInt(0)
 46:         t1.Sub(q, a)
 47:         v := big.NewInt(0)
 48:         v.Exp(alpha, t1, p) // note the 'p' is the &quot;mod&quot;
 49: 
 50:         fmt.Printf(&quot;Setup Complete: v=%s\n&quot;, v)
 51:         fmt.Printf(`&quot;Save 'v' for user &quot;alice&quot;` + &quot;\n&quot;)
 52: 
 53:         fmt.Printf(`%s/api/register-user%s, send-data=%s{&quot;user&quot;:&quot;alice&quot;,&quot;v&quot;:%d}%s`+&quot;\n&quot;,
 54:             MiscLib.ColorYellow, MiscLib.ColorReset, MiscLib.ColorYellow, v, MiscLib.ColorReset)
 55:         // Save the validation value 'v' for &quot;alice&quot; in the database.
 56:         database[&quot;alice&quot;] = &amp;DBRecord{v: v}
 57:         fmt.Printf(`%sResponse: {&quot;status&quot;:&quot;success&quot;, &quot;username&quot;:&quot;alice&quot;, &quot;msg&quot;:&quot;is registered.&quot;}%s`+&quot;\n&quot;,
 58:             MiscLib.ColorCyan, MiscLib.ColorReset)
 59:     }
 60: 
 61:     // Alice is the Client:
 62: 
 63:     // ----------------------------------------------------------
 64:     // Message 1 - Client to Server
 65:     // ----------------------------------------------------------
 66: 
 67:     // Alice Chooses, and send to Bob
 68:     // r := big.NewInt(543) // Should be random, but for this example
 69:     randNum := genRan(999)
 70:     fmt.Printf(&quot;random genrated: %d\n&quot;, randNum)
 71:     r := big.NewInt(randNum)
 72:     x := big.NewInt(0)
 73:     x.Exp(alpha, r, p) // x=(alpha^r) % p
 74: 
 75:     fmt.Printf(&quot;Send To Bob : x=%s\n&quot;, x)
 76:     fmt.Printf(`%s/api/login%s, send-data=%s{&quot;username&quot;:&quot;alice&quot;,&quot;x&quot;:%d}%s`+&quot;\n&quot;,
 77:         MiscLib.ColorYellow, MiscLib.ColorReset, MiscLib.ColorYellow, x, MiscLib.ColorReset)
 78:     dbr := database[&quot;alice&quot;]
 79:     v := dbr.v
 80:     fmt.Printf(`Server looks up in the database 'v' for &quot;alice&quot;, v=%d`+&quot;\n&quot;, v)
 81: 
 82:     // ------------------------------------------------------------------------
 83:     // Response to Message 1, Server back to client
 84:     // ------------------------------------------------------------------------
 85:     {
 86:         dbr := database[&quot;alice&quot;]
 87:         dbr.x = x
 88:         database[&quot;alice&quot;] = dbr
 89:     }
 90: 
 91:     y := big.NewInt(0)
 92:     // Bob is the Server:
 93:     // Bob sends the challenge 'e' back to Alice e to do the computation
 94:     // e := big.NewInt(1000) // how chose (random?)
 95:     randNum = genRan(999)
 96:     e := big.NewInt(randNum)
 97:     {
 98:         dbr := database[&quot;alice&quot;]
 99:         dbr.e = e
100:         database[&quot;alice&quot;] = dbr
101:     }
102:     fmt.Printf(`%sResponse: {&quot;status&quot;:&quot;success&quot;, &quot;e&quot;:%d}%s`+&quot;\n&quot;, MiscLib.ColorCyan, e, MiscLib.ColorReset)
103:     {
104: 
105:         // Alice(client) now computes: y = a*e % q
106:         t2 := big.NewInt(0)
107:         t2.Mul(a, e)
108:         t2.Mod(t2, q) // 45664
109:         t2.Add(t2, r) // 851 is correct
110: 
111:         y = t2
112:         fmt.Printf(&quot;y=%s\n&quot;, y) // Prints 851
113:         fmt.Printf(`%s/api/login-pt1%s, send-data: %s{&quot;username&quot;:%q,&quot;y&quot;:%d}%s`+&quot;\n&quot;,
114:             MiscLib.ColorYellow, MiscLib.ColorReset, MiscLib.ColorYellow, &quot;alice&quot;, y, MiscLib.ColorReset)
115:         fmt.Printf(`response: %s{&quot;status&quot;:&quot;success&quot;,&quot;y&quot;:%d}%s`+&quot;\n&quot;,
116:             MiscLib.ColorCyan, y, MiscLib.ColorReset)
117:     }
118:     {
119:         dbr := database[&quot;alice&quot;]
120:         dbr.y = y
121:         database[&quot;alice&quot;] = dbr
122:     }
123: 
124:     // At this point.
125:     // Alice has 'y' - by calculating it from 'e'
126:     // Bob has 'y' saved in database.
127: 
128:     // ------------------------------------------------------------------------
129:     // Message 2 - Client (Alice) with response to challenge.
130:     // ------------------------------------------------------------------------
131: 
132:     z := big.NewInt(0)
133:     {
134:         // Bob (server) verifies: x == z == (a^y) * (v^e) % p
135:         // or a Better version of the same calulation
136:         // Bob (server) verifies: x == z == ((a^y)%p)*((v^e)%p) % p
137: 
138:         dbr := database[&quot;alice&quot;]
139:         v := dbr.v // Validation value
140:         e := dbr.e // random saved from earlier
141:         y := dbr.y // calculated on server and saved.
142:         fmt.Printf(`Server looks up in the database 'v','e','y' for &quot;alice&quot;, v=%d`+&quot;\n&quot;, v)
143: 
144:         t3 := big.NewInt(0)
145:         t3.Exp(alpha, y, p)
146:         t4 := big.NewInt(0)
147:         t4.Exp(v, e, p)
148:         t5 := big.NewInt(0)
149:         t5.Mul(t3, t4)
150:         t5.Mod(t5, p)
151:         z = t5
152:     }
153: 
154:     fmt.Printf(&quot;z=%s\n&quot;, z)
155:     fmt.Printf(`%s/api/login-pt2%s, send-data: %s{&quot;username&quot;:&quot;alice&quot;}%s`+&quot;\n&quot;,
156:         MiscLib.ColorYellow, MiscLib.ColorReset, MiscLib.ColorYellow, MiscLib.ColorReset)
157: 
158:     // ------------------------------------------------------------------------
159:     // Response 2 - Success/Fail message from server back to client
160:     // ------------------------------------------------------------------------
161: 
162:     {
163:         // fetch 'x' from earlier
164:         dbr := database[&quot;alice&quot;]
165:         x = dbr.x
166: 
167:         if x.Cmp(z) == 0 {
168:             fmt.Printf(&quot;%sAuthoized! Yea, 'alice' is a valid user%s\n&quot;, MiscLib.ColorGreen, MiscLib.ColorReset)
169:             fmt.Printf(`%sResponse: {&quot;status&quot;:&quot;success&quot;,&quot;msg&quot;:&quot;'alice' is logged in&quot;}%s`+&quot;\n&quot;,
170:                 MiscLib.ColorCyan, MiscLib.ColorReset)
171:         } else {
172:             fmt.Printf(&quot;%sNope nope nope%s\n&quot;, MiscLib.ColorRed, MiscLib.ColorReset)
173:             fmt.Printf(`%sResponse: {&quot;status&quot;:&quot;error&quot;,&quot;msg&quot;:&quot;'alice' is not a valid user&quot;}%s`+&quot;\n&quot;,
174:                 MiscLib.ColorRed, MiscLib.ColorReset)
175:         }
176:     }
177: 
178: }
179: 
180: func genRan(m int) int64 {
181:     return int64(rand.Intn(m))
182: }

</code></pre>

<p>Reunsts of 2 runs:</p>

<p><img src="2-runs.png" alt="2-runs.png" /></p>

</div>

